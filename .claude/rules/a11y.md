# Accesibilidad y Lighthouse

## Contraste de colores (WCAG AA - 4.5:1 mínimo)

```scss
// ✅ CORRECTO - Alto contraste
.avatar {
  background: #4f46e5; // indigo-600
  color: #ffffff;      // Contraste ~6.5:1
}

// ❌ INCORRECTO - Bajo contraste
.avatar {
  background: var(--primary-100);
  color: var(--primary-400);      // Lighthouse penaliza
}
```

## Colores aprobados

| Uso | Fondo | Texto | Contraste |
|-----|-------|-------|-----------|
| Avatar/Botón primario | `#4f46e5` | `#ffffff` | 6.5:1 |
| Texto normal | `--surface-ground` | `--text-color` | 7:1+ |
| Texto secundario | `--surface-ground` | `--text-color-secondary` | 4.5:1+ |
| Error | `#dc2626` | `#ffffff` | 4.5:1 |

## Botones e interactivos

### Botones HTML nativos

```html
<!-- ✅ CORRECTO -->
<button type="button" aria-label="Cerrar menú">
  <i class="pi pi-times"></i>
</button>

<!-- ❌ INCORRECTO - Sin tipo ni label -->
<button>
  <i class="pi pi-times"></i>
</button>
```

### Botones PrimeNG con solo iconos

**IMPORTANTE**: Botones de PrimeNG que solo tienen icono (sin label/texto) DEBEN usar `pt` (passthrough) para agregar `aria-label`.

```html
<!-- ✅ CORRECTO - Botón con icono + aria-label usando pt -->
<button
  pButton
  icon="pi pi-refresh"
  class="p-button-outlined"
  (click)="refresh()"
  [pt]="{
    root: {
      'aria-label': 'Refrescar',
    },
  }"
></button>

<!-- ✅ CORRECTO - Botón con label visible (no requiere pt) -->
<button
  pButton
  label="Refrescar"
  icon="pi pi-refresh"
  (click)="refresh()"
></button>

<!-- ❌ INCORRECTO - Botón con solo icono sin aria-label -->
<button
  pButton
  icon="pi pi-refresh"
  (click)="refresh()"
></button>
```

### Patrón pt para accesibilidad

La propiedad `pt` (passthrough) de PrimeNG permite pasar atributos HTML directos al elemento raíz del componente.

```typescript
// Estructura de pt
[pt]="{
  root: {                    // Elemento raíz del componente
    'aria-label': 'Texto',   // Atributo HTML aria-label
  },
}"
```

### Casos comunes con pt

#### Botones de acción (tabla, cards)

```html
<!-- Ver detalles -->
<button
  pButton
  icon="pi pi-eye"
  class="p-button-rounded p-button-text"
  (click)="view(item)"
  [pt]="{
    root: {
      'aria-label': 'Ver detalles',
    },
  }"
></button>

<!-- Editar -->
<button
  pButton
  icon="pi pi-pencil"
  class="p-button-rounded p-button-text"
  (click)="edit(item)"
  [pt]="{
    root: {
      'aria-label': 'Editar',
    },
  }"
></button>

<!-- Eliminar -->
<button
  pButton
  icon="pi pi-trash"
  class="p-button-rounded p-button-text p-button-danger"
  (click)="delete(item)"
  [pt]="{
    root: {
      'aria-label': 'Eliminar',
    },
  }"
></button>
```

#### Botones con tooltip

**IMPORTANTE**: Aunque el botón tenga `pTooltip`, DEBE tener también `aria-label` para screen readers.

```html
<!-- ✅ CORRECTO - pt + pTooltip -->
<button
  pButton
  icon="pi pi-eye"
  pTooltip="Ver detalles"
  tooltipPosition="top"
  (click)="view(item)"
  [pt]="{
    root: {
      'aria-label': 'Ver detalles',
    },
  }"
></button>

<!-- ❌ INCORRECTO - Solo tooltip sin aria-label -->
<button
  pButton
  icon="pi pi-eye"
  pTooltip="Ver detalles"
  (click)="view(item)"
></button>
```

**Razón**: `pTooltip` es solo visual (aparece al hacer hover). Los screen readers no lo leen automáticamente.

#### Botones dinámicos (estado condicional)

```html
<!-- ✅ CORRECTO - aria-label dinámico -->
<button
  pButton
  [icon]="usuario.estado ? 'pi pi-ban' : 'pi pi-check'"
  class="p-button-rounded p-button-text"
  [class.p-button-warning]="usuario.estado"
  [class.p-button-success]="!usuario.estado"
  (click)="toggleEstado(usuario)"
  [pt]="{
    root: {
      'aria-label': usuario.estado ? 'Desactivar' : 'Activar',
    },
  }"
></button>
```

### Checklist para botones

Para cualquier botón con PrimeNG:

```
[ ] ¿Tiene label visible? → No requiere pt
[ ] ¿Solo tiene icono? → DEBE tener pt con aria-label
[ ] ¿Tiene tooltip? → También DEBE tener pt con aria-label
[ ] ¿Es dinámico? → aria-label debe ser dinámico también
[ ] ¿Está en tabla/lista? → Aria-label debe ser descriptivo ("Ver detalles", no solo "Ver")
```

### Tabla de referencia

| Botón | Label visible | Tooltip | pt requerido | Ejemplo aria-label |
|-------|--------------|---------|--------------|-------------------|
| Con label + icono | ✅ | ❌ | ❌ No | - |
| Solo icono | ❌ | ❌ | ✅ Sí | "Refrescar" |
| Solo icono + tooltip | ❌ | ✅ | ✅ Sí | "Ver detalles" |
| Solo icono + dinámico | ❌ | ❌/✅ | ✅ Sí | "Activar" / "Desactivar" |

## Imágenes

```html
<!-- ✅ CORRECTO -->
<img src="logo.png" alt="Logo de Educa" width="120" height="40" />

<!-- ❌ INCORRECTO -->
<img src="logo.png" />
```

## Imágenes optimizadas

```html
<picture>
  <source srcset="image.avif" type="image/avif" />
  <source srcset="image.webp" type="image/webp" />
  <img src="image.png" alt="Descripción" width="400" height="300" loading="lazy" />
</picture>
```

## Lazy loading

```html
<!-- Above the fold - cargar inmediato -->
<img src="hero.webp" fetchpriority="high" />

<!-- Below the fold - lazy load -->
<img src="feature.webp" loading="lazy" />
```

## Evitar layout shifts (CLS)

```scss
img {
  width: 100%;
  height: auto;
  aspect-ratio: 16 / 9;  // SIEMPRE definir aspect-ratio
}
```

## Estructura de encabezados

```html
<!-- ✅ CORRECTO - Jerarquía lógica -->
<h1>Título Principal</h1>
<h2>Sección</h2>
<h3>Subsección</h3>

<!-- ❌ INCORRECTO - Saltar niveles -->
<h1>Título</h1>
<h4>Subsección</h4>
```

## Landmarks

```html
<header>...</header>
<nav aria-label="Navegación principal">...</nav>
<main>...</main>
<footer>...</footer>
```

## Verificación

```bash
npx lighthouse http://localhost:4201 --view # considerar que el performance siempre será mayor en produccción.
```
