<div class="attendance-container">
	<app-attendance-header [loading]="loading()" (reload)="reloadAll()" />

	<app-attendance-legend />

	@if (userRole === 'Apoderado') {
		<!-- Vista Apoderado: selector integrado en las tablas -->
		@if (hijos().length > 0) {
			<app-attendance-table
				[table]="ingresos()"
				[hijos]="hijos()"
				[selectedHijoId]="selectedHijoId()"
				(monthChange)="onIngresosMonthChange($event)"
				(hijoChange)="selectHijo($event)"
			/>
			<app-attendance-table
				[table]="salidas()"
				[hijos]="hijos()"
				[selectedHijoId]="selectedHijoId()"
				(monthChange)="onSalidasMonthChange($event)"
				(hijoChange)="selectHijo($event)"
			/>
		} @else if (!loading()) {
			<div class="no-data">
				<p>No se encontraron hijos registrados.</p>
			</div>
		}
	} @else if (userRole === 'Profesor') {
		<!-- Vista Profesor: selector de salón + selector de estudiante -->
		@if (salones().length > 0) {
			<div class="salon-selector">
				<label>Salón:</label>
				<select (change)="selectSalon(+$any($event.target).value)">
					@for (salon of salones(); track salon.salonId) {
						<option
							[value]="salon.salonId"
							[selected]="salon.salonId === selectedSalonId()"
						>
							{{ salon.nombreSalon }}
							@if (salon.esTutor) {
								(Tutor {{ nombreProfesor }})
							} @else {
								(Profesor {{ nombreProfesor }})
							}
						</option>
					}
				</select>
			</div>

			@if (estudiantes().length > 0) {
				<app-attendance-table
					[table]="ingresos()"
					[hijos]="estudiantesAsHijos()"
					[selectedHijoId]="selectedEstudianteId()"
					(monthChange)="onIngresosMonthChange($event)"
					(hijoChange)="selectEstudiante($event)"
				/>
				<app-attendance-table
					[table]="salidas()"
					[hijos]="estudiantesAsHijos()"
					[selectedHijoId]="selectedEstudianteId()"
					(monthChange)="onSalidasMonthChange($event)"
					(hijoChange)="selectEstudiante($event)"
				/>
			} @else if (!loading()) {
				<div class="no-data">
					<p>No se encontraron estudiantes en este salón.</p>
				</div>
			}
		} @else if (!loading()) {
			<div class="no-data">
				<p>No tiene salones asignados.</p>
			</div>
		}
	} @else {
		<!-- Vista Estudiante: tablas propias -->
		<app-attendance-table [table]="ingresos()" (monthChange)="onIngresosMonthChange($event)" />
		<app-attendance-table [table]="salidas()" (monthChange)="onSalidasMonthChange($event)" />
	}
</div>
