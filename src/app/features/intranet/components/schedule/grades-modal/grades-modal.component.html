<p-dialog
	[visible]="visible"
	(visibleChange)="onVisibleChange($event)"
	[modal]="true"
	[dismissableMask]="true"
	[draggable]="false"
	[resizable]="false"
	class="grades-modal"
	[showHeader]="false"
>
	<!-- * Grades table + simulation UI -->
	<div class="modal-content grades-content">
		<h2>{{ currentCourseGrades.name }}</h2>
		<div class="grades-table">
			<div class="grades-header">
				<span class="col-eval">Evaluaciones</span>
				<span class="col-grade">Nota</span>
			</div>
			@for (evaluation of currentCourseGrades.evaluations; track evaluation.name) {
				<div class="grades-row">
					<span class="col-eval" [class.eval-link]="$first">{{ evaluation.name }}</span>
					@if (simulationMode && evaluation.editable) {
						<input
							type="number"
							class="grade-input"
							[value]="evaluation.tempGrade"
							min="0"
							max="20"
							(input)="updateTempGrade(evaluation, $any($event.target).value)"
						/>
					} @else {
						<span
							class="col-grade"
							[class]="getGradeClass(getDisplayGrade(evaluation))"
						>
							{{ getDisplayGrade(evaluation) }}
						</span>
					}
				</div>
			}
			<div class="grades-row grades-total">
				<span class="col-eval">
					<!-- * Toggle simulation -->
					<button
						class="simulate-btn"
						[class.active]="simulationMode"
						(click)="toggleSimulation()"
					>
						{{ simulationMode ? 'Cancelar simulación' : 'Simular promedio' }}
					</button>
				</span>
				<span class="col-grade-label">Promedio</span>
				<span class="col-grade" [class]="getGradeClass(currentAverage)">
					{{ currentAverage }}
				</span>
			</div>
		</div>
		@if (simulationMode) {
			<!-- * Simulation disclaimer -->
			<p class="simulation-note">
				Modifica las notas para simular tu promedio. Los cambios no se guardarán.
			</p>
		}
	</div>
</p-dialog>
