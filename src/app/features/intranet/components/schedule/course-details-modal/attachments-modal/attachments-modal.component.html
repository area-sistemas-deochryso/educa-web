<p-dialog
	[visible]="visible"
	(visibleChange)="onVisibleChange($event)"
	[modal]="true"
	[dismissableMask]="true"
	[draggable]="false"
	[resizable]="false"
	class="attachments-modal"
	[showHeader]="false"
>
	<div class="modal-content">
		<h2>Archivos Adjuntos</h2>
		<p class="week-label">{{ weekName }}</p>

		<!-- Upload Section -->
		<div class="upload-section">
			<p-fileUpload
				#fileUpload
				mode="basic"
				[multiple]="true"
				[maxFileSize]="50000000"
				[auto]="true"
				[customUpload]="true"
				(uploadHandler)="onFileSelect($event)"
				chooseLabel="Subir Archivos"
				chooseIcon="pi pi-upload"
				[disabled]="vm().uploading"
			></p-fileUpload>

			@if (vm().uploading) {
				<div class="upload-progress">
					<p-progressSpinner
						class="w-4rem h-4rem"
						strokeWidth="4"
						fill="var(--surface-ground)"
						animationDuration=".5s"
					></p-progressSpinner>
					<span>Subiendo archivo...</span>
				</div>
			}
		</div>

		<div class="attachments-list">
			@for (attachment of vm().attachments; track attachment.id) {
				<div class="attachment-item" [class.unread]="!attachment.isRead">
					<div class="attachment-icon">
						<i class="pi" [ngClass]="getIcon(attachment.type)"></i>
					</div>
					<div class="attachment-info">
						<span class="attachment-name">{{ attachment.name }}</span>
						<span class="attachment-meta"
							>{{ attachment.size }} Â· {{ attachment.date }}</span
						>
					</div>
					<div class="attachment-actions">
						@if (!attachment.isRead) {
							<span class="unread-badge">Nuevo</span>
						}
						<button
							class="action-btn"
							(click)="onDownloadAttachment(attachment)"
							title="Descargar"
						>
							<i class="pi pi-download"></i>
						</button>
					</div>
				</div>
			}
		</div>

		<div class="modal-footer">
			<span class="count-info">{{ vm().totalCount }} archivos</span>
		</div>
	</div>
</p-dialog>
