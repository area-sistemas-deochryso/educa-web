<!-- #region Template -->
<div class="weekly-container">
  <!-- * Grid de horarios -->
  <div class="weekly-grid-container">
    <!-- * Columna de tiempo -->
    <div class="time-column">
      <div class="time-header">Hora</div>
      @for (hora of HORAS; track hora) {
        <div class="time-slot">{{ hora }}</div>
      }
    </div>

    <!-- * Columnas por día -->
    @for (dia of DIAS; track dia.value) {
      <div class="day-column">
        <!-- * Header del día -->
        <div class="day-header">{{ dia.label }}</div>

        <!-- * Grid de horas del día -->
        <div class="day-grid">
          <!-- * Líneas de fondo para las horas -->
          @for (hora of HORAS; track hora) {
            <div class="hour-line"></div>
          }

          <!-- * Bloques de horarios -->
          <div class="blocks-container">
            @for (block of getBlocksForDay(dia.value); track trackByBlockId($index, block)) {
              <div
                class="horario-block"
                [ngStyle]="getBlockStyle(block)"
                [class.inactive]="!block.horario.estado"
                [pTooltip]="getTooltipContent(block)"
                tooltipPosition="top"
                (click)="onBlockClick(block)"
              >
                <div class="block-content">
                  <!-- Nombre del curso -->
                  <div class="curso-nombre">{{ block.horario.cursoNombre }}</div>

                  <!-- Horario -->
                  <div class="horario-tiempo">
                    <i class="pi pi-clock"></i>
                    {{ block.horario.horaInicio }} - {{ block.horario.horaFin }}
                  </div>

                  <!-- Salón -->
                  <div class="salon-info">
                    <i class="pi pi-building"></i>
                    {{ block.horario.salonDescripcion }}
                  </div>

                  <!-- Profesor -->
                  @if (block.horario.profesorNombreCompleto) {
                    <div class="profesor-info">
                      <i class="pi pi-user"></i>
                      {{ block.horario.profesorNombreCompleto }}
                    </div>
                  } @else {
                    <div class="profesor-info sin-profesor">
                      <i class="pi pi-user-minus"></i>
                      Sin profesor
                    </div>
                  }

                  <!-- Estudiantes -->
                  <div class="estudiantes-count">
                    <i class="pi pi-users"></i>
                    {{ block.horario.cantidadEstudiantes }}
                  </div>

                  <!-- * Acciones (aparecen al hover) -->
                  <div class="block-actions">
                    <button
                      pButton
                      icon="pi pi-eye"
                      class="p-button-rounded p-button-text p-button-sm action-btn"
                      (click)="onViewDetailClick($event, block)"
                      [pt]="{ root: { 'aria-label': 'Ver detalles' } }"
                    ></button>

                    <button
                      pButton
                      icon="pi pi-pencil"
                      class="p-button-rounded p-button-text p-button-sm action-btn"
                      (click)="onEditClick($event, block)"
                      [pt]="{ root: { 'aria-label': 'Editar' } }"
                    ></button>
                  </div>
                </div>
              </div>
            }
          </div>
        </div>
      </div>
    }
  </div>

  <!-- * Estado de carga -->
  @if (loading()) {
    <div class="loading-overlay">
      <i class="pi pi-spin pi-spinner" style="font-size: 2rem"></i>
      <p>Cargando horarios...</p>
    </div>
  }

  <!-- * Estado vacío -->
  @if (!loading() && blocks().length === 0) {
    <div class="empty-overlay">
      <i class="pi pi-calendar" style="font-size: 3rem; opacity: 0.3"></i>
      <p>No hay horarios para mostrar</p>
      <p class="empty-hint">Aplica filtros diferentes o crea un nuevo horario</p>
    </div>
  }
</div>
<!-- #endregion -->
