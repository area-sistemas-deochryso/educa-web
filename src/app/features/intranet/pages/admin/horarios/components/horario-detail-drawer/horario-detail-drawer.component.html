<!-- #region Template -->
<p-drawer
	[visible]="visible()"
	(visibleChange)="onVisibleChange($event)"
	position="right"
	[modal]="true"
	[closeOnEscape]="true"
	[style]="{ width: '600px' }"
>
	<ng-template pTemplate="header">
		<!-- * Drawer header -->
		<div class="drawer-header">
			<div class="header-icon">
				<i class="pi pi-calendar"></i>
			</div>
			<div class="header-content">
				<h2>Detalles del Horario</h2>
				<p class="header-subtitle">Información completa y asignaciones</p>
			</div>
		</div>
	</ng-template>

	@if (loading()) {
		<!-- * Loading state -->
		<div class="loading-state">
			<i class="pi pi-spin pi-spinner"></i>
			<p>Cargando detalles...</p>
		</div>
	} @else if (detalle()) {
		<div class="detail-content">
			<!-- * Estado y acciones rápidas -->
			<div class="status-section">
				<p-tag
					[value]="getEstadoLabel(detalle()!.estado)"
					[severity]="getEstadoSeverity(detalle()!.estado)"
				/>

				<div class="quick-actions">
					<button
						pButton
						icon="pi pi-pencil"
						class="p-button-rounded p-button-text p-button-info"
						(click)="onEdit()"
						pTooltip="Editar horario"
						tooltipPosition="top"
						[pt]="{
							root: {
								'aria-label': 'Editar horario',
							},
						}"
					></button>

					<button
						pButton
						[icon]="detalle()!.estado ? 'pi pi-ban' : 'pi pi-check'"
						class="p-button-rounded p-button-text"
						[class.p-button-warning]="detalle()!.estado"
						[class.p-button-success]="!detalle()!.estado"
						(click)="onToggleEstado()"
						[pTooltip]="detalle()!.estado ? 'Desactivar horario' : 'Activar horario'"
						tooltipPosition="top"
						[pt]="{
							root: {
								'aria-label': detalle()!.estado ? 'Desactivar' : 'Activar',
							},
						}"
					></button>

					<button
						pButton
						icon="pi pi-trash"
						class="p-button-rounded p-button-text p-button-danger"
						(click)="onDelete()"
						pTooltip="Eliminar horario"
						tooltipPosition="top"
						[pt]="{
							root: {
								'aria-label': 'Eliminar',
							},
						}"
					></button>
				</div>
			</div>

			<!-- * Información básica -->
			<div class="info-section">
				<h3 class="section-title">
					<i class="pi pi-info-circle"></i>
					Información General
				</h3>

				<div class="info-grid">
					<div class="info-item">
						<label>Día</label>
						<div class="info-value">
							<i class="pi pi-calendar"></i>
							<span>{{ detalle()!.diaSemanaDescripcion }}</span>
						</div>
					</div>

					<div class="info-item">
						<label>Horario</label>
						<div class="info-value">
							<i class="pi pi-clock"></i>
							<span>{{ detalle()!.horaInicio }} - {{ detalle()!.horaFin }}</span>
						</div>
					</div>

					<div class="info-item">
						<label>Salón</label>
						<div class="info-value">
							<i class="pi pi-building"></i>
							<span>{{ detalle()!.salonDescripcion }}</span>
						</div>
					</div>

					<div class="info-item">
						<label>Curso</label>
						<div class="info-value">
							<i class="pi pi-book"></i>
							<span>{{ detalle()!.cursoNombre }}</span>
						</div>
					</div>
				</div>
			</div>

			<!-- Asignación de Profesor -->
			<div class="assignment-section">
				<h3 class="section-title">
					<i class="pi pi-user"></i>
					Profesor Asignado
				</h3>

				@if (detalle()!.profesorId && detalle()!.profesorNombreCompleto) {
					<div class="assigned-professor">
						<div class="professor-info">
							<div class="professor-avatar">
								<i class="pi pi-user"></i>
							</div>
							<div class="professor-details">
								<strong>{{ detalle()!.profesorNombreCompleto }}</strong>
								<small>DNI: {{ detalle()!.profesorDni }}</small>
							</div>
						</div>
					</div>
				} @else {
					<div class="no-assignment">
						<i class="pi pi-exclamation-triangle"></i>
						<p>No hay profesor asignado</p>

						<div class="assign-professor-form">
							<p-select
								[options]="profesoresOptions()"
								[(ngModel)]="selectedProfesorId"
								placeholder="Seleccionar profesor..."
								optionLabel="label"
								optionValue="value"
								appendTo="body"
								[filter]="true"
								filterPlaceholder="Buscar profesor..."
								[showClear]="true"
								class="w-full"
							/>

							<button
								pButton
								label="Asignar Profesor"
								icon="pi pi-user-plus"
								class="p-button-sm w-full"
								[disabled]="!selectedProfesorId"
								(click)="onAsignarProfesor()"
								pTooltip="Asignar el profesor seleccionado a este horario"
								tooltipPosition="top"
							></button>
						</div>
					</div>
				}
			</div>

			<!-- Asignación de Estudiantes -->
			<div class="assignment-section">
				<h3 class="section-title">
					<i class="pi pi-users"></i>
					Estudiantes Asignados
					<p-badge [value]="detalle()!.estudiantes.length.toString()" />
				</h3>

				@if (hasEstudiantes()) {
					<div class="students-list">
						@for (estudiante of detalle()!.estudiantes; track trackByEstudianteId($index, estudiante)) {
							<div class="student-item">
								<div class="student-avatar">
									<i class="pi pi-user"></i>
								</div>
								<div class="student-info">
									<strong>{{ estudiante.nombreCompleto }}</strong>
									<small>DNI: {{ estudiante.dni }}</small>
								</div>
							</div>
						}
					</div>
				} @else {
					<div class="no-assignment">
						<i class="pi pi-users"></i>
						<p>No hay estudiantes asignados</p>

						<button
							pButton
							label="Asignar Todos los Estudiantes del Salón"
							icon="pi pi-user-plus"
							class="p-button-sm p-button-outlined w-full"
							(click)="onAsignarTodosEstudiantes()"
							pTooltip="Asignar automáticamente todos los estudiantes del salón a este horario"
							tooltipPosition="top"
						></button>
					</div>
				}
			</div>

			<!-- Información de Auditoría -->
			<div class="audit-section">
				<h3 class="section-title">
					<i class="pi pi-history"></i>
					Auditoría
				</h3>

				<div class="audit-info">
					@if (detalle()!.usuarioReg) {
						<div class="audit-item">
							<label>Creado por:</label>
							<span>{{ detalle()!.usuarioReg }}</span>
						</div>
					}

					@if (detalle()!.usuarioMod) {
						<div class="audit-item">
							<label>Modificado por:</label>
							<span>{{ detalle()!.usuarioMod }}</span>
						</div>
					}
				</div>
			</div>
		</div>
	} @else {
		<div class="empty-state">
			<i class="pi pi-info-circle"></i>
			<p>Selecciona un horario para ver sus detalles</p>
		</div>
	}

	<ng-template pTemplate="footer">
		<button
			pButton
			label="Cerrar"
			icon="pi pi-times"
			class="p-button-text"
			(click)="onClose()"
			pTooltip="Cerrar panel de detalles"
			tooltipPosition="top"
		></button>
	</ng-template>
</p-drawer>
<!-- #endregion -->
