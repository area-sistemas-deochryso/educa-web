<!-- #region Template -->
<div class="usuarios-container">
	<!-- * Header actions -->
	<app-usuarios-header (refresh)="onRefresh()" />

	@if (vm().showSkeletons && !vm().statsReady) {
		<!-- * Stats skeleton while loading -->
		<app-usuarios-stats-skeleton />
	} @else if (vm().hasEstadisticas) {
		<app-usuarios-stats [estadisticas]="vm().estadisticas!" />
	}

	<!-- * Filters + search -->
	<app-usuarios-filters
		[searchTerm]="vm().searchTerm"
		[filterRol]="vm().filterRol"
		[filterEstado]="vm().filterEstado"
		[options]="filterOptions"
		(searchChange)="onSearchChange($event)"
		(filterRolChange)="onFilterRolChange($event)"
		(filterEstadoChange)="onFilterEstadoChange($event)"
		(clearFilters)="onClearFilters()"
		(newUsuario)="onNewUsuario()"
	/>

	@if (vm().showSkeletons && !vm().tableReady) {
		<!-- * Table skeleton while loading -->
		<section class="table-section" style="min-height: 420px;">
			<app-usuarios-table-skeleton />
		</section>
	} @else {
		<!-- * Users table -->
		<app-usuarios-table
			[usuarios]="vm().filteredUsuarios"
			[loading]="vm().loading"
			(viewDetail)="onViewDetail($event)"
			(edit)="onEditUsuario($event)"
			(toggleEstado)="onToggleEstado($event)"
		/>
	}
</div>

<!-- * Detail drawer -->
<app-usuario-detail-drawer
	[visible]="vm().detailDrawerVisible"
	[usuario]="vm().selectedUsuario"
	(visibleChange)="onDrawerVisibleChange($event)"
	(closeDrawer)="onCloseDetail()"
	(edit)="onEditFromDetail()"
/>

<!-- * Create/Edit form dialog -->
<app-usuario-form-dialog
	[visible]="vm().dialogVisible"
	[isEditing]="vm().isEditing"
	[formData]="formData"
	[errors]="formErrors"
	[isFormValid]="vm().isFormValid"
	[salones]="vm().salones"
	(visibleChange)="onDialogVisibleChange($event)"
	(fieldChange)="onFormFieldChange($event)"
	(save)="onSaveUsuario()"
	(cancelDialog)="onCancelDialog()"
/>

<!-- * Confirmation dialog host -->
<p-confirmDialog (onHide)="onConfirmDialogHide()" />
<!-- #endregion -->
