<div class="attendance-container">
	<app-attendance-header [loading]="loading()" (reload)="reloadAll()" />

	<app-attendance-legend />

	@switch (userRole) {
		@case ('Apoderado') {
			@if (hijos().length > 0) {
				<app-attendance-table
					[table]="ingresos()"
					[hijos]="hijos()"
					[selectedHijoId]="selectedHijoId()"
					(monthChange)="onIngresosMonthChange($event)"
					(hijoChange)="selectHijo($event)"
				/>
				<app-attendance-table
					[table]="salidas()"
					[hijos]="hijos()"
					[selectedHijoId]="selectedHijoId()"
					(monthChange)="onSalidasMonthChange($event)"
					(hijoChange)="selectHijo($event)"
				/>
			} @else if (!loading()) {
				<app-empty-state message="No se encontraron hijos registrados." />
			}
		}
		@case ('Profesor') {
			@if (salones().length > 0) {
				<app-salon-selector
					[salones]="salones()"
					[selectedSalonId]="selectedSalonId()"
					[nombreProfesor]="nombreProfesor"
					(salonChange)="selectSalon($event)"
				/>

				@if (estudiantes().length > 0) {
					<app-attendance-table
						[table]="ingresos()"
						[hijos]="estudiantesAsHijos()"
						[selectedHijoId]="selectedEstudianteId()"
						(monthChange)="onIngresosMonthChange($event)"
						(hijoChange)="selectEstudiante($event)"
					/>
					<app-attendance-table
						[table]="salidas()"
						[hijos]="estudiantesAsHijos()"
						[selectedHijoId]="selectedEstudianteId()"
						(monthChange)="onSalidasMonthChange($event)"
						(hijoChange)="selectEstudiante($event)"
					/>
				} @else if (!loading()) {
					<app-empty-state message="No se encontraron estudiantes en este salón." />
				}
			} @else if (!loading()) {
				<app-empty-state message="No tiene salones asignados." />
			}
		}
		@case ('Director') {
			<app-estadisticas-dia
				[estadisticas]="estadisticasDia()"
				[downloadingPdf]="downloadingPdf()"
				(descargarPdf)="descargarPdfAsistenciaDia()"
			/>

			@if (gradosSecciones().length > 0) {
				<app-grado-seccion-selector
					[gradosSecciones]="gradosSecciones()"
					[selectedGradoSeccion]="selectedGradoSeccion()"
					(gradoSeccionChange)="selectGradoSeccion($event)"
				/>

				@if (estudiantesDirector().length > 0) {
					<app-attendance-table
						[table]="ingresos()"
						[hijos]="estudiantesDirectorAsHijos()"
						[selectedHijoId]="selectedEstudianteDirectorId()"
						(monthChange)="onIngresosMonthChange($event)"
						(hijoChange)="selectEstudianteDirector($event)"
					/>
					<app-attendance-table
						[table]="salidas()"
						[hijos]="estudiantesDirectorAsHijos()"
						[selectedHijoId]="selectedEstudianteDirectorId()"
						(monthChange)="onSalidasMonthChange($event)"
						(hijoChange)="selectEstudianteDirector($event)"
					/>
				} @else if (!loading()) {
					<app-empty-state message="No se encontraron estudiantes en este grado/sección." />
				}
			} @else if (!loading()) {
				<app-empty-state message="No hay grados/secciones disponibles." />
			}
		}
		@default {
			<app-attendance-table
				[table]="ingresos()"
				(monthChange)="onIngresosMonthChange($event)"
			/>
			<app-attendance-table
				[table]="salidas()"
				(monthChange)="onSalidasMonthChange($event)"
			/>
		}
	}
</div>
