<app-attendance-legend />

@if (salones().length > 0) {
	<div class="selector-row">
		<app-salon-selector
			[salones]="salones()"
			[selectedSalonId]="selectedSalonId()"
			[nombreProfesor]="nombreProfesor()"
			(salonChange)="viewMode() === 'dia' ? selectSalonDia($event) : selectSalon($event)"
		/>

		@if (selectedSalon() && viewMode() === 'mes') {
			<div class="pdf-section">
				<span class="pdf-label">Reporte del día: {{ pdfFecha() | date: 'dd/MM/yyyy' }}</span>
				<p-button
					icon="pi pi-file-pdf"
					[loading]="downloadingPdf()"
					severity="danger"
					[text]="true"
					[rounded]="true"
					(onClick)="togglePdfMenu($event)"
					pTooltip="Opciones de PDF"
					tooltipPosition="top"
					[pt]="{
						root: {
							'aria-label': 'Opciones de PDF',
						},
					}"
				/>
				<p-menu #pdfMenu [model]="pdfMenuItems" [popup]="true" appendTo="body" />
			</div>
		}
	</div>

	@if (viewMode() === 'mes') {
		@if (showSkeletons() && !tableReady()) {
			<!-- Skeleton mostrado inmediatamente con espacio reservado -->
			<app-attendance-table-skeleton />
			<app-attendance-table-skeleton />
		} @else if (estudiantes().length > 0) {
			<app-attendance-table
				[table]="ingresos()"
				[hijos]="estudiantesAsHijos()"
				[selectedHijoId]="selectedEstudianteId()"
				(monthChange)="onIngresosMonthChange($event)"
				(hijoChange)="selectEstudiante($event)"
			/>
			<app-attendance-table
				[table]="salidas()"
				[hijos]="estudiantesAsHijos()"
				[selectedHijoId]="selectedEstudianteId()"
				(monthChange)="onSalidasMonthChange($event)"
				(hijoChange)="selectEstudiante($event)"
			/>
		} @else if (!loading()) {
			<app-empty-state message="No se encontraron estudiantes en este salón." />
		}
	} @else {
		<app-asistencia-dia-list
			[estudiantes]="estudiantesDia()"
			[fecha]="fechaDia()"
			[loading]="loading()"
			[showPdfButton]="selectedSalon() !== null"
			[downloadingPdf]="downloadingPdf()"
			[pdfMenuItems]="pdfMenuItems"
			(fechaChange)="onFechaDiaChange($event)"
		/>
	}
} @else if (!loading()) {
	<app-empty-state message="No tiene salones asignados." />
}
